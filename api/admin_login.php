<?php header('Content-Type: application/json; charset=utf-8'); require_once __DIR__.'/db.php'; $in=json_decode(file_get_contents('php://input'),true)?:[]; $u=$in['username']??''; $p=$in['password']??''; if(!$u||!$p){echo json_encode(['success'=>false,'error'=>'Missing']);exit;} $stmt=$pdo->prepare('SELECT admin_id,username,password,role FROM admins WHERE username=? LIMIT 1'); $stmt->execute([$u]); $a=$stmt->fetch(); if(!$a||!password_verify($p,$a['password'])){echo json_encode(['success'=>false,'error'=>'Invalid']);exit;} $token=bin2hex(random_bytes(16)); $stmt=$pdo->prepare('UPDATE admins SET api_token=?, last_login_at=NOW() WHERE admin_id=?'); $stmt->execute([$token,$a['admin_id']]); echo json_encode(['success'=>true,'token'=>$token,'admin'=>['admin_id'=>$a['admin_id'],'username'=>$a['username'],'role'=>$a['role']]]); ?>